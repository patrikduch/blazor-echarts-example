@page "/"
@inject IJSRuntime JS
@rendermode InteractiveServer

<h3>ECharts Example</h3>

<div style="position: relative; width: 600px; height: 400px;">
    @if (isLoading)
    {
        <div style="
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255,255,255,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;">
            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                <div class="spinner"></div>
                <span style="font-style: italic; color: #555;">Loading chart...</span>
            </div>
        </div>
    }

    <div id="mainChart" style="width: 100%; height: 100%;"></div>
</div>

@code {
    private bool isLoading = true;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var chartOptions = new
            {
                title = new { text = "ECharts Intro Chart" },
                tooltip = new { },
                legend = new { data = new[] { "Sales" } },
                xAxis = new { data = new[] { "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun" } },
                yAxis = new { },
                series = new[] {
                    new {
                        name = "Sales",
                        type = "bar",
                        data = new[] { 5, 20, 36, 10, 10, 20, 30 }
                    }
                }
            };

            await JS.InvokeVoidAsync("echartsInterop.initChart", "mainChart", chartOptions);
            isLoading = false;
            StateHasChanged(); // triggers re-render to hide overlay
        }
    }
}
